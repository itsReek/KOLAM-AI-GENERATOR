<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PATTERNOVA</title>
    <!-- Google Fonts with fallback -->
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* ================= COMMON ================= */
      body {
        font-family: "Roboto", Arial, Helvetica, sans-serif;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
        display: flex;
        background: #111; /* fallback */
        color: #fff; /* fallback */
        transition: background 0.5s ease, color 0.5s ease;
      }

      /* ================= DARK MODE ================= */
      body.dark {
        color: #ffffff;
        background: linear-gradient(120deg, #0f0c29, #302b63, #24243e);
        background-size: 600% 600%;
        animation: backgroundShift 20s ease infinite;
      }

      /* ================= LIGHT MODE ================= */
      body.light {
        color: #222;
        background: linear-gradient(120deg, #fdfbfb, #f6f9fc, #ffffff);
        background-size: 600% 600%;
        animation: backgroundShiftLight 20s ease infinite;
      }

      @keyframes backgroundShift {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      @keyframes backgroundShiftLight {
        0% {
          background-position: 50% 0%;
        }
        50% {
          background-position: 50% 100%;
        }
        100% {
          background-position: 50% 0%;
        }
      }

      /* ================= OVERLAY ================= */
      body::after {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url("https://cdn0.weddingwire.in/article/9461/original/960/jpg/41649-pulli-kolam-images-shanthisridharan-weddings.jpeg")
          no-repeat center center fixed;
        background-size: cover;
        opacity: 0.05;
        pointer-events: none;
      }

      /* ================= SIDEBAR ================= */
      .sidebar {
        width: 220px;
        background: rgba(0, 0, 0, 0.9);
        border-right: 2px solid #ff4b2b;
        height: 100vh;
        padding: 20px;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1000;
        box-shadow: 5px 0 25px rgba(0, 0, 0, 0.6);
      }
      body.light .sidebar {
        background: #ffffff;
        border-right: 2px solid #ff6f61;
        box-shadow: 5px 0 20px rgba(255, 111, 97, 0.2);
      }
      .sidebar h2 {
        color: #ff4b2b;
        margin-bottom: 20px;
      }
      body.light .sidebar h2 {
        color: #ff6f61;
      }
      .sidebar a {
        display: block;
        color: #fff;
        text-decoration: none;
        padding: 12px;
        border-radius: 10px;
        transition: all 0.3s ease;
      }
      body.light .sidebar a {
        color: #444;
        font-weight: 600;
      }
      .sidebar a:hover {
        background: #ff4b2b;
        color: #fff !important;
      }

      /* ================= MAIN ================= */
      .main {
        margin-left: 240px;
        flex: 1;
      }

      /* ================= HEADER ================= */
      header {
        background: #1a1a2e;
        padding: 30px 20px 60px;
        border-bottom: 4px solid rgba(255, 255, 255, 0.3);
        border-radius: 0 0 40px 40px;
        text-align: center;
        position: relative;
      }
      body.light header {
        background: #ffecec;
        border-bottom: 4px solid rgba(255, 111, 97, 0.4);
      }
      header h1 {
        font-size: 2.8rem;
        margin-bottom: 10px;
        color: #ff4b2b;
      }
      body.light header h1 {
        color: #ff6f61;
      }
      header p {
        font-size: 1.2rem;
        color: #f0f0f0;
      }
      body.light header p {
        color: #333;
      }

      #kolamHeaderCanvas {
        display: block;
        margin: 20px auto 0;
        background: transparent;
      }

      /* ================= TOGGLE BUTTON ================= */
      .toggle-mode {
        position: absolute;
        top: 20px;
        right: 20px;
        padding: 10px 20px;
        background: #ff4b2b;
        border: none;
        color: #fff;
        font-weight: 600;
        border-radius: 10px;
        cursor: pointer;
      }
      body.light .toggle-mode {
        background: #444;
        color: #fff;
      }

      /* ================= SECTIONS ================= */
      section {
        margin: 50px auto;
        max-width: 800px;
        background: rgba(0, 0, 0, 0.6);
        border-radius: 15px;
        padding: 20px;
      }
      body.light section {
        background: #fff9f5;
        border: 1px solid #ff6f61;
      }

      h2 {
        font-size: 1.9rem;
        margin-bottom: 15px;
        color: #ff4b2b;
      }
      body.light h2 {
        color: #ff6f61;
      }

      p {
        font-size: 1rem;
        color: #ddd;
        line-height: 1.6;
      }
      body.light p {
        color: #333;
      }

      input[type="file"] {
        margin-top: 15px;
        padding: 12px;
        border: 2px dashed #ff4b2b;
        border-radius: 12px;
        background: #111;
        color: #fff;
      }
      body.light input[type="file"] {
        border: 2px dashed #ff6f61;
        background: #fff2ec;
        color: #444;
      }

      canvas,
      img,
      video {
        max-width: 100%;
        margin-top: 20px;
        border-radius: 15px;
        border: 2px solid #ff4b2b;
      }
      body.light canvas,
      body.light img,
      body.light video {
        border: 2px solid #ff6f61;
      }

      button {
        padding: 14px 40px;
        background: #ff4b2b;
        color: #fff;
        border: none;
        border-radius: 15px;
        cursor: pointer;
        margin-top: 15px;
      }
      body.light button {
        background: #ff6f61;
      }

      footer {
        margin-top: 40px;
        padding: 25px;
        background: #000;
        color: #f0f0f0;
        font-size: 14px;
        text-align: center;
      }
      body.light footer {
        background: #fff2ec;
        color: #444;
      }
    </style>
  </head>
  <body class="dark">
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>Kolam Menu</h2>
      <a href="#upload">Upload Kolam</a>
      <a href="#dots">Dot Detection</a>
      <a href="#about">About</a>
      <a href="#services">Services</a>
      <a href="#video">Video</a>
    </div>

    <!-- Main -->
    <div class="main">
      <header>
        <h1>PATTERNOVA</h1>
        <p>Preserving Tradition with Machine Learning ⚡</p>
        <canvas id="kolamHeaderCanvas" width="300" height="300"></canvas>
        <button class="toggle-mode" id="toggleModeBtn">🌙 Dark Mode</button>
      </header>

      <!-- Upload -->
      <section id="upload">
        <h2>Upload a Kolam</h2>
        <input type="file" id="fileInput" accept="image/*" />
        <div id="uploadedPreview"></div>
      </section>

      <!-- Dot Detection -->
      <section id="dots">
        <h2>Dot Detection</h2>
        <button onclick="analyzeKolam()">Analyze Kolam</button>
        <div id="dotResult"></div>
      </section>

      <!-- About -->
      <section id="about">
        <h2>About Us</h2>
        <p>
          Kolam AI Generator is a digital initiative to preserve and modernize
          the traditional art of Kolam using Artificial Intelligence.
        </p>
      </section>

      <!-- Services -->
      <section id="services">
        <h2>Our Services</h2>
        <p>✨ Upload and analyze Kolam patterns with AI detection.</p>
        <p>✨ Detect dots and symmetry in traditional designs.</p>
        <p>✨ Provide step-by-step visual analysis.</p>
        <p>✨ Learn and explore new Kolam patterns interactively.</p>
      </section>

      <!-- Video -->
      <section id="video">
        <h2>Watch Our Demo</h2>
        <video controls>
          <source src="your-demo-video.mp4" type="video/mp4" />
          Your browser does not support the video tag.
        </video>
      </section>

      <footer>
        <p>© 2025 Kolam AI Project</p>
      </footer>
    </div>

    <script>
      /* ================= HEADER KOLAM ANIMATION ================= */
      const kolamCanvas = document.getElementById("kolamHeaderCanvas");
      const kctx = kolamCanvas.getContext("2d");

      function drawPongalKolam(t) {
        kctx.clearRect(0, 0, kolamCanvas.width, kolamCanvas.height);
        kctx.strokeStyle = "#ff4b2b";
        kctx.lineWidth = 2;
        const cx = 150,
          cy = 150,
          radius = 60;

        for (let j = 0; j < 4; j++) {
          kctx.beginPath();
          for (let i = 0; i <= 360; i += 30) {
            const angle = ((i + t * 30) * Math.PI) / 180;
            const r = radius + Math.sin((i + t) / 10) * 20;
            const x = cx + Math.cos(angle + j * (Math.PI / 2)) * r;
            const y = cy + Math.sin(angle + j * (Math.PI / 2)) * r;
            if (i === 0) kctx.moveTo(x, y);
            else kctx.lineTo(x, y);
          }
          kctx.closePath();
          kctx.stroke();
        }
        requestAnimationFrame(() => drawPongalKolam(t + 1));
      }
      drawPongalKolam(0);

      /* ================= UPLOAD PREVIEW ================= */
      const fileInput = document.getElementById("fileInput");
      const uploadedPreview = document.getElementById("uploadedPreview");
      let uploadedImageData = null;

      fileInput.addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          uploadedImageData = e.target.result;
          uploadedPreview.innerHTML = `<img src="${uploadedImageData}" alt="Uploaded Kolam" style="max-width: 300px;">`;
        };
        reader.readAsDataURL(file);
      });

      /* ================= DOT DETECTION ================= */
      function analyzeKolam() {
        const dotResult = document.getElementById("dotResult");

        if (!uploadedImageData) {
          alert("Please upload a Kolam first!");
          return;
        }

        dotResult.innerHTML = `<p style="color:#ff4b2b;">🤖 Detecting dots...</p>`;

        const img = new Image();
        img.src = uploadedImageData;

        img.onload = function () {
          const canvas = document.createElement("canvas");
          canvas.width = img.width;
          canvas.height = img.height;
          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0);

          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const data = imageData.data;
          let dotCount = 0;

          for (let i = 0; i < data.length; i += 4) {
            const r = data[i],
              g = data[i + 1],
              b = data[i + 2];
            const brightness = 0.299 * r + 0.587 * g + 0.114 * b;
            if (brightness > 240) dotCount++;
          }
          dotCount = Math.floor(dotCount / 100);

          // Decide shape type based on dots
          let shapeType = "Flower 🌸 (default)";
          if (dotCount % 4 === 0) shapeType = "Flower 🌸";
          else if (dotCount % 5 === 0) shapeType = "Diamond 💎";
          else if (dotCount % 6 === 0) shapeType = "Spiral 🌀";
          else if (dotCount % 7 === 0) shapeType = "Heart ❤️";

          dotResult.innerHTML = `
            <p><b>Dots detected:</b> ${dotCount}</p>
            <p><b>Detected Shape:</b> ${shapeType}</p>
            <p><b>Available Shapes:</b> Flower 🌸 | Diamond 💎 | Spiral 🌀 | Heart ❤️</p>
          `;
        };
      }

      /* ================= TOGGLE DARK/LIGHT ================= */
      const toggleBtn = document.getElementById("toggleModeBtn");
      const body = document.body;

      try {
        if (localStorage.getItem("theme") === "light") {
          body.classList.remove("dark");
          body.classList.add("light");
          toggleBtn.textContent = "☀️ Light Mode";
        }
      } catch (e) {
        console.warn("LocalStorage not supported");
      }

      toggleBtn.addEventListener("click", () => {
        if (body.classList.contains("dark")) {
          body.classList.remove("dark");
          body.classList.add("light");
          toggleBtn.textContent = "☀️ Light Mode";
          try {
            localStorage.setItem("theme", "light");
          } catch (e) {}
        } else {
          body.classList.remove("light");
          body.classList.add("dark");
          toggleBtn.textContent = "🌙 Dark Mode";
          try {
            localStorage.setItem("theme", "dark");
          } catch (e) {}
        }
      });
    </script>
  </body>
</html>
